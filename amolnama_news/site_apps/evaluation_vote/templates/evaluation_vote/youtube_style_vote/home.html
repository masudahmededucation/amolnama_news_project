{% extends "evaluation_vote/base.html" %}
{% load static %}

{% block title %}Vote ┬╖ Amolnama News{% endblock %}


{% block content %}
<section>
  <!-- Page Title -->
  <div class="section-head">
    {% if evaluation %}
      <h2>{{ evaluation.evaluation_name_bn }}</h2>
    {% endif %}
  </div>
  
  <div class="vote-content">

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb" id="breadcrumb">
      <span class="current">Division (ржмрж┐ржнрж╛ржЧ)</span>
    </div>

    <!-- Division Selection List -->
    <div id="division-view">
      <h3>Select Your Division (ржЖржкржирж╛рж░ ржмрж┐ржнрж╛ржЧ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи)</h3>
      <ul class="selection-list">
        {% for division in divisions %}
          <li onclick="selectDivision({{ division.division_id }}, '{{ division.division_name_en }}', '{{ division.division_name_bn }}')">
            <span class="name-en">{{ division.division_name_en }}</span>
            <span class="name-bn">({{ division.division_name_bn }})</span>
          </li>
        {% empty %}
          <li>No divisions found (ржХрзЛржирзЛ ржмрж┐ржнрж╛ржЧ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐)</li>
        {% endfor %}
      </ul>
    </div>

    <!-- District Selection List (hidden initially) -->
    <div id="district-view" style="display: none;">
      <button class="back-btn" onclick="goBackToDivisions()">тЖР Back / ржкрж┐ржЫржирзЗ</button>
      <h3>Select Your District (ржЖржкржирж╛рж░ ржЬрзЗрж▓рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи)</h3>
      <ul class="selection-list" id="district-list"></ul>
    </div>

    <!-- Constituency Selection List (hidden initially) -->
    <div id="constituency-view" style="display: none;">
      <button class="back-btn" onclick="goBackToDistricts()">тЖР Back / ржкрж┐ржЫржирзЗ</button>
      <h3>Select Your Constituency (ржЖржкржирж╛рж░ ржирж┐рж░рзНржмрж╛ржЪржирзА ржПрж▓рж╛ржХрж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи)</h3>
      <ul class="selection-list" id="constituency-list"></ul>
    </div>

    <!-- Party Selection List (hidden initially) -->
    <div id="party-view" style="display: none;">
      <button class="back-btn" onclick="goBackToConstituencies()">тЖР Back / ржкрж┐ржЫржирзЗ</button>
      <h3>Select Party (ржжрж▓ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи)</h3>
      <ul class="selection-list party-list" id="party-list-selection">
        {% for party in parties %}
          <li onclick="selectParty({{ party.party_id }}, '{{ party.party_name_en }}', '{{ party.party_name_bn }}', event)">
            <div class="party-item">
              <img 
                src="/media/{{ party.file_path }}{{ party.file_name }}"
                alt="{{ party.party_short_name_bn }}"
                class="party-logo"
              />
              <div class="party-text">
                <div class="party-info">
                  <span class="party-short">{{ party.party_short_name_bn }}</span>
                  <span class="party-separator">-</span>
                  <span class="party-name">{{ party.party_name_bn }}</span>
                </div>
                <div class="party-details">
                  <span class="party-alliance">ржЬрзЛржЯ ржжрж▓</span>
                  <span class="party-symbol">{{ party.party_symbol_name_bn }}</span>
                </div>
                {% if party.vote_percentage %}
                <div class="bar-container">
                  <div class="bar-fill" style="width: {{ party.vote_percentage }}%;"></div>
                  <span class="pct-text">{{ party.vote_percentage|floatformat:1 }}%</span>
                </div>
                {% endif %}
              </div>
            </div>
          </li>
        {% empty %}
          <li>No parties found / ржХрзЛржирзЛ ржжрж▓ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Success View (shown after vote, hidden initially) -->
    <div id="success-view" style="display: none;">
      <div class="success-card">
        <!-- Success message with tick icon -->
        <p class="success-message" style="text-align: center; font-size: 1.2em; margin: 10px 0;">
          <span style="color: #0a0; font-size: 2em; font-weight: bold; vertical-align: middle;">тЬФ</span>
          <span style="margin-left: 10px;">ржЖржкржирж╛рж░ ржнрзЛржЯ ржЧрзНрж░рж╣ржг ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ</span>
        </p>
        <!-- Vote summary, comma separated, responsive -->
        <p class="vote-summary-info">
          ржмрж┐ржнрж╛ржЧ: {{ division_name }}, ржЬрзЗрж▓рж╛: {{ district_name }}, ржирж┐рж░рзНржмрж╛ржЪржирзА ржПрж▓рж╛ржХрж╛: {{ constituency_name }}, ржжрж▓: {{ party_name }}
        </p>

        <!-- Party list with progress bars, always visible after voting -->
        <p class="total-vote-info" id="total-vote-info" style="text-align:center; font-weight:bold; margin: 10px 0;">
          <!-- Will be filled by JS -->
        </p>
        <ul class="selection-list party-list" id="party-list-success">
          <!-- Will be filled by JS after voting -->
        </ul>
        <!-- Optional: More info form for user feedback -->
        <div class="optional-card">
          <h4>ЁЯМЯ ржЖрж░ржУ рждржерзНржп ржжрж┐рзЯрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзБржи (Optional)</h4>
          <div class="form-group">
            <label for="vote-reason" id="reason-label">ржПржЗ ржжрж▓ржЯрж┐ржХрзЗ ржмрзЗржЫрзЗ ржирзЗржУржпрж╝рж╛рж░ ржорзВрж▓ ржХрж╛рж░ржг ржХрзА?</label>
            <textarea 
              id="vote-reason" 
              class="form-textarea" 
              maxlength="500" 
              rows="3"
              placeholder="ржЖржкржирж╛рж░ ржорждрж╛ржоржд рж▓рж┐ржЦрзБржи..."
            ></textarea>
            <div class="char-count"><span id="char-count">0</span>/500</div>
          </div>
          <p class="optional-note">рж╕рзБржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржлрж▓рж╛ржлрж▓ ржкрзЗрждрзЗ ржЖржкржирж╛рж░ ржЗржЙржирж┐ржпрж╝ржи ржмрж╛ ржПрж▓рж╛ржХрж╛ржЯрж┐ ржмрзЗржЫрзЗ ржирж┐ржи</p>
          <div class="form-group">
            <label for="upazila">ржЙржкржЬрзЗрж▓рж╛ / Upazila</label>
            <select id="upazila" class="form-select" onchange="loadUnions()">
              <option value="">-- ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи / Select --</option>
            </select>
          </div>
          <div class="form-group">
            <label for="union">ржЗржЙржирж┐ржпрж╝ржи ржкрж░рж┐рж╖ржж / Union Parishad</label>
            <select id="union" class="form-select" disabled>
              <option value="">-- ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи / Select --</option>
            </select>
          </div>
          <button class="update-btn" onclick="updateVote()">рждржерзНржп ржЖржкржбрзЗржЯ ржХрж░рзБржи / Update Info</button>
          <div class="update-success" id="update-success">
            <span class="tick-icon">тЬУ</span>
            <span>рждржерзНржп ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ! / Info Updated!</span>
          </div>
        </div>
        <!-- Button to start a new vote -->
        <button class="new-vote-btn" onclick="startNewVote()">ржирждрзБржи ржнрзЛржЯ ржжрж┐ржи / Cast Another Vote</button>
      </div>
    </div>

  </div>

  <aside class="sidebar">
  {% include "evaluation_vote/partials/sidebar_past_vote_results.html" %}
</aside>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'evaluation_vote/assets/js/pages/home.js' %}?v=2"></script>
{% endblock %}