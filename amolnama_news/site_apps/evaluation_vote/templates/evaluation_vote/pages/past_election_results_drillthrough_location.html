{% extends "core/base.html" %}
{% load static %}

{% block title %}{{ evaluation_name }} ¬∑ Results{% endblock %}

{% block extra_css %}
<!-- Import CSS for party list and progress bars -->
<link rel="stylesheet" href="{% static 'evaluation_vote/assets/css/components/voting-selection.css' %}">
<link rel="stylesheet" href="{% static 'evaluation_vote/assets/css/components/voting-progress.css' %}">
<link rel="stylesheet" href="{% static 'evaluation_vote/assets/css/components/youtube-style-total-vote-info.css' %}">
{% endblock %}

{% block content %}
<section class="grid">
  <div>
    <!-- Breadcrumb navigation -->
    <nav class="breadcrumb" style="margin-bottom: 1rem;">
      {% for crumb in breadcrumb %}
        {% if crumb.url %}
          <a href="{{ crumb.url }}">{{ crumb.name }}</a> /
        {% else %}
          <span>{{ crumb.name }}</span>
        {% endif %}
      {% endfor %}
    </nav>

    <!-- Back button for non-national levels -->
    {% if back_url %}
      <a href="{{ back_url }}" class="back-btn" style="display: inline-block; margin-bottom: 1rem; padding: 0.5rem 1rem; color: var(--primary); text-decoration: none; border: 1px solid var(--border); border-radius: var(--radius);">
        ‚Üê Back / ‡¶™‡¶ø‡¶õ‡¶®‡ßá
      </a>
    {% endif %}

    <!-- Results display based on drill level -->
    {% if drill_level == 'national' %}
      <!-- Level 1: National Results - All Parties -->
      <h3>National Level Results / ‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h3>

      <!-- Total vote count component -->
      {% include "evaluation_vote/components/youtube-style-total-vote-info.html" %}

      <ul class="selection-list party-list" style="margin-top: 1rem;">
        {% for result in results %}
          <li>
            <div class="party-item">
              {% if result.party_logo_file %}
                <img
                  src="/media/{{ result.party_logo_path }}{{ result.party_logo_file }}"
                  alt="{{ result.party_short_name }}"
                  class="party-logo"
                />
              {% else %}
                <div class="party-logo" style="background: var(--muted); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                  üèõÔ∏è
                </div>
              {% endif %}
              <div class="party-text">
                <div class="party-info">
                  <span class="party-short">{{ result.party_short_name }}</span>
                  <span class="party-separator">-</span>
                  <span class="party-name">{{ result.party_name }}</span>
                </div>
                <!-- YouTube-style progress bar -->
                <div class="bar-container">
                  <div class="bar-fill" style="width: {{ result.vote_percentage }}%;"></div>
                  <span class="pct-text">
                    {{ result.vote_percentage|floatformat:1 }}%
                    <span class="vote-count">({{ result.total_votes|default:"0"|floatformat:0 }} ‡¶≠‡ßã‡¶ü)</span>
                  </span>
                </div>
              </div>
            </div>
          </li>
        {% empty %}
          <li style="text-align: center; padding: 2rem; color: var(--muted);">
            No results found / ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø
          </li>
        {% endfor %}
      </ul>

      <!-- Drill through to divisions -->
      <div style="text-align: center; margin-top: 2rem;">
        <a href="?view=divisions" class="btn-primary" style="padding: 0.75rem 2rem; background: var(--primary); color: white; text-decoration: none; border-radius: var(--radius); display: inline-block;">
          View Division Level Results ‚Üí
        </a>
      </div>

    {% elif drill_level == 'division' %}
      <!-- Level 2: Division Level Results - All Divisions with All Parties -->
      <h3>Division Level Results / ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h3>

      {% for division_result in results %}
        <div style="margin-bottom: 3rem; border: 2px solid var(--border); border-radius: var(--radius); padding: 1.5rem; background: var(--card);">
          <h4 style="margin: 0 0 0.5rem 0;">
            {{ division_result.division }}
          </h4>
          <p style="margin: 0 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border);">
            <span class="highlight-vote">‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü: {{ division_result.total_votes|floatformat:0 }}</span>
          </p>

          <ul class="selection-list party-list">
            {% for party in division_result.parties %}
              <li>
                <div class="party-item">
                  {% if party.file_name %}
                    <img
                      src="/media/{{ party.file_path }}{{ party.file_name }}"
                      alt="{{ party.party_short_name }}"
                      class="party-logo"
                    />
                  {% else %}
                    <div class="party-logo" style="background: var(--muted); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                      üèõÔ∏è
                    </div>
                  {% endif %}
                  <div class="party-text">
                    <div class="party-info">
                      <span class="party-short">{{ party.party_short_name }}</span>
                      <span class="party-separator">-</span>
                      <span class="party-name">{{ party.party_name }}</span>
                    </div>
                    <div class="bar-container">
                      <div class="bar-fill" style="width: {{ party.percentage }}%;"></div>
                      <span class="pct-text">
                        {{ party.percentage|floatformat:1 }}%
                        <span class="vote-count">({{ party.votes|floatformat:0 }} ‡¶≠‡ßã‡¶ü)</span>
                      </span>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>

          <!-- Drill through to districts -->
          <div style="text-align: center; margin-top: 1rem;">
            <a href="?division_id={{ division_result.division_id }}" style="color: var(--primary); text-decoration: none; font-weight: bold;">
              View Districts in {{ division_result.division }} ‚Üí
            </a>
          </div>
        </div>
      {% empty %}
        <p style="text-align: center; padding: 2rem; color: var(--muted);">
          No divisions found / ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø
        </p>
      {% endfor %}

    {% elif drill_level == 'district' %}
      <!-- Level 3: District Level Results - All Districts with All Parties -->
      <h3>District Level Results / ‡¶ú‡ßá‡¶≤‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h3>

      {% for district_result in results %}
        <div style="margin-bottom: 3rem; border: 2px solid var(--border); border-radius: var(--radius); padding: 1.5rem; background: var(--card);">
          <h4 style="margin: 0 0 0.5rem 0;">
            {{ district_result.district }}
          </h4>
          <p style="margin: 0 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border);">
            <span class="highlight-vote">‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü: {{ district_result.total_votes|floatformat:0 }}</span>
          </p>

          <ul class="selection-list party-list">
            {% for party in district_result.parties %}
              <li>
                <div class="party-item">
                  {% if party.file_name %}
                    <img
                      src="/media/{{ party.file_path }}{{ party.file_name }}"
                      alt="{{ party.party_short_name }}"
                      class="party-logo"
                    />
                  {% else %}
                    <div class="party-logo" style="background: var(--muted); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                      üèõÔ∏è
                    </div>
                  {% endif %}
                  <div class="party-text">
                    <div class="party-info">
                      <span class="party-short">{{ party.party_short_name }}</span>
                      <span class="party-separator">-</span>
                      <span class="party-name">{{ party.party_name }}</span>
                    </div>
                    <div class="bar-container">
                      <div class="bar-fill" style="width: {{ party.percentage }}%;"></div>
                      <span class="pct-text">
                        {{ party.percentage|floatformat:1 }}%
                        <span class="vote-count">({{ party.votes|floatformat:0 }} ‡¶≠‡ßã‡¶ü)</span>
                      </span>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>

          <!-- Drill through to constituencies -->
          <div style="text-align: center; margin-top: 1rem;">
            <a href="?division_id={{ current_division_id }}&district_id={{ district_result.district_id }}" style="color: var(--primary); text-decoration: none; font-weight: bold;">
              View Constituencies in {{ district_result.district }} ‚Üí
            </a>
          </div>
        </div>
      {% empty %}
        <p style="text-align: center; padding: 2rem; color: var(--muted);">
          No districts found / ‡¶ï‡ßã‡¶®‡ßã ‡¶ú‡ßá‡¶≤‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø
        </p>
      {% endfor %}

    {% elif drill_level == 'constituency' %}
      <!-- Level 4: Constituency Level Results - All Constituencies with All Parties -->
      <h3>Constituency Level Results / ‡¶Ü‡¶∏‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h3>

      {% for constituency_result in results %}
        <div style="margin-bottom: 3rem; border: 2px solid var(--border); border-radius: var(--radius); padding: 1.5rem; background: var(--card);">
          <h4 style="margin: 0 0 0.5rem 0;">{{ constituency_result.seat_name }}</h4>
          <p style="margin: 0 0 0.5rem 0; color: var(--muted); font-size: 0.9rem;">
            {{ constituency_result.area_list }}
          </p>
          <p style="margin: 0 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border);">
            <span class="highlight-vote">‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü: {{ constituency_result.total_votes|floatformat:0 }}</span>
          </p>

          <ul class="selection-list party-list">
            {% for party in constituency_result.parties %}
              <li>
                <div class="party-item">
                  {% if party.file_name %}
                    <img
                      src="/media/{{ party.file_path }}{{ party.file_name }}"
                      alt="{{ party.party_short_name }}"
                      class="party-logo"
                    />
                  {% else %}
                    <div class="party-logo" style="background: var(--muted); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                      üèõÔ∏è
                    </div>
                  {% endif %}
                  <div class="party-text">
                    <div class="party-info">
                      <span class="party-short">{{ party.party_short_name }}</span>
                      <span class="party-separator">-</span>
                      <span class="party-name">{{ party.party_name }}</span>
                    </div>
                    <div class="bar-container">
                      <div class="bar-fill" style="width: {{ party.percentage }}%;"></div>
                      <span class="pct-text">
                        {{ party.percentage|floatformat:1 }}%
                        <span class="vote-count">({{ party.votes|floatformat:0 }} ‡¶≠‡ßã‡¶ü)</span>
                      </span>
                    </div>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% empty %}
        <p style="text-align: center; padding: 2rem; color: var(--muted);">
          No constituencies found / ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶∏‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø
        </p>
      {% endfor %}

    {% endif %}

  </div>

  <aside class="sidebar">
    {% include "evaluation_vote/partials/sidebar_past_vote_results.html" %}
  </aside>
</section>
{% endblock %}
