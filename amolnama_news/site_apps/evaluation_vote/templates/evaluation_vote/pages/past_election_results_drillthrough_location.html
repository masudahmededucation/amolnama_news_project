{% extends "core/base.html" %}
{% load static %}

{% block title %}{{ evaluation_name }} · Results{% endblock %}

{% block extra_css %}
<!-- Import CSS for party list and progress bars -->
<link rel="stylesheet" href="{% static 'evaluation_vote/assets/css/components/voting-selection.css' %}">
<link rel="stylesheet" href="{% static 'evaluation_vote/assets/css/components/voting-progress.css' %}">
<link rel="stylesheet" href="{% static 'evaluation_vote/assets/css/components/youtube-style-total-vote-info.css' %}">
{% endblock %}

{% block content %}
<section class="grid">
  <div>
    <!-- Breadcrumb navigation -->
    <nav class="breadcrumb" style="margin-bottom: 1rem;">
      {% for crumb in breadcrumb %}
        {% if crumb.url %}
          <a href="{{ crumb.url }}">{{ crumb.name }}</a> /
        {% else %}
          <span>{{ crumb.name }}</span>
        {% endif %}
      {% endfor %}
    </nav>

    <!-- Back button for non-national levels -->
    {% if back_url %}
      <a href="{{ back_url }}" class="back-btn" style="display: inline-block; margin-bottom: 1rem; padding: 0.5rem 1rem; color: var(--primary); text-decoration: none; border: 1px solid var(--border); border-radius: var(--radius);">
        ← Back / পিছনে
      </a>
    {% endif %}

    <!-- Results display based on drill level -->
    {% if drill_level == 'national' %}
      <!-- Level 1: National Results - All Parties -->
      <h3>National Level Results / জাতীয় পর্যায়ের ফলাফল</h3>

      {% include "evaluation_vote/components/youtube-style-total-vote-info.html" %}

      <ul class="selection-list party-list" style="margin-top: 1rem;">
        {% for result in results %}
          {% include "evaluation_vote/components/party-result-item.html" with party=result %}
        {% empty %}
          <li style="text-align: center; padding: 2rem; color: var(--muted);">
            No results found / কোনো ফলাফল পাওয়া যায়নি
          </li>
        {% endfor %}
      </ul>

      <!-- Drill through to divisions -->
      <div style="text-align: center; margin-top: 2rem;">
        <a href="?view=divisions" class="btn-primary" style="padding: 0.75rem 2rem; background: var(--primary); color: white; text-decoration: none; border-radius: var(--radius); display: inline-block;">
          View Division Level Results →
        </a>
      </div>

    {% elif drill_level == 'division' %}
      <!-- Level 2: Division Level Results -->
      <h3>Division Level Results / বিভাগ পর্যায়ের ফলাফল</h3>
      {% for item in results %}
        {% include "evaluation_vote/partials/location-result-card.html" with heading=item.heading total_votes=item.total_votes parties=item.parties drilldown_url=item.drilldown_url drilldown_text=item.drilldown_text %}
      {% empty %}
        <p style="text-align: center; padding: 2rem; color: var(--muted);">
          No divisions found / কোনো বিভাগ পাওয়া যায়নি
        </p>
      {% endfor %}

    {% elif drill_level == 'district' %}
      <!-- Level 3: District Level Results -->
      <h3>District Level Results / জেলা পর্যায়ের ফলাফল</h3>
      {% for item in results %}
        {% include "evaluation_vote/partials/location-result-card.html" with heading=item.heading total_votes=item.total_votes parties=item.parties drilldown_url=item.drilldown_url drilldown_text=item.drilldown_text %}
      {% empty %}
        <p style="text-align: center; padding: 2rem; color: var(--muted);">
          No districts found / কোনো জেলা পাওয়া যায়নি
        </p>
      {% endfor %}

    {% elif drill_level == 'constituency' %}
      <!-- Level 4: Constituency Level Results (lowest level, no drilldown) -->
      <h3>Constituency Level Results / আসন পর্যায়ের ফলাফল</h3>
      {% for item in results %}
        {% include "evaluation_vote/partials/location-result-card.html" with heading=item.heading total_votes=item.total_votes parties=item.parties area_list=item.area_list %}
      {% empty %}
        <p style="text-align: center; padding: 2rem; color: var(--muted);">
          No constituencies found / কোনো আসন পাওয়া যায়নি
        </p>
      {% endfor %}

    {% endif %}

  </div>

  <aside class="sidebar">
    {% include "evaluation_vote/partials/sidebar_past_vote_results.html" %}
  </aside>
</section>
{% endblock %}
